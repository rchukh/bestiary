{
  "variables": {
    "postgresql_password": "postgres"
  },
  "provisioners" : [
    {
      "type": "file",
      "source": "../../../keepers/timescaledb/packer/files/pg_prometheus.patch",
      "destination": "/tmp/pg_prometheus.patch"
    },
    {
      "type": "shell",
      "environment_vars": [
        "POSTGRESQL_PASSWORD={{user `postgresql_password`}}"
      ],
      "scripts": [
          "../../../keepers/timescaledb/packer/mutation/timescaledb.sh",
          "mutation/prometheus.sh",
          "mutation/prometheus-postgresql-adapter.sh"
      ]
    }
  ],
  "builders": [
    {
      "type": "virtualbox-ovf",
      "communicator": "ssh",
      "source_path": "file:///tmp/ovf/centos7/centos7.ovf",
      "ssh_username": "vagrant",
      "ssh_private_key_file": "C:/Workspace/VM/bestiary/.vagrant/machines/default/virtualbox/private_key",
      "ssh_port": "22",
      "shutdown_command": "echo 'packer' | sudo -S shutdown -P now",
      "vm_name" : "bestiary-prometheus-{{timestamp}}"
    }
  ],
  "post-processors": ["vagrant"]
}
